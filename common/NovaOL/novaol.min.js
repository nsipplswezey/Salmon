var globl=new Object();Novaol=function(b,a){this.index=a;var c=function(h){var f=h[0];for(var g=1;g<h.length-1;g++){f=e(f,h[g])}return f};var e=function(n,l){var g={};for(var h in n){g[h]=n[h]}for(var h in l){if(!(h in n)){g[h]=l[h];continue}var f=n[h];var o=l[h];if(Array.isArray(f)){var m=[];for(var k in f){m[k]=f[k]}if(Array.isArray(o)){g[h]=d(f,o)}else{if(m.indexOf(o)<0){m.push(o)}g[h]=m}}else{g[h]=(f==o)?f:new Array(f,o)}}return g};var d=function(f,j){var g=[];for(var h in f){g[h]=f[h]}for(var h in j){if(f.indexOf(j[h])<0){g.push(j[h])}}return g};this.data=c(arguments);this.project=this.data.project;this.nmify="globl['"+this.project+"'].novaManager['"+this.index+"']";this.tag=this.project+"_"+this.index};Novaol.prototype.git0=function(a){return(Array.isArray(a))?a[0]:a};Novaol.prototype.gitn=function(a){return(Array.isArray(a))?a[a.length-1]:a};Novaol.prototype.timefield=function(){return[{type:"field",id:"timeval_"+this.tag,text:"Time",size:6,value:0}]},Novaol.prototype.simcontrols=function(){return[{type:"slider",id:"simhi",text:"Simulation End",min:this.data.clock.lo,max:this.data.clock.max,value:this.data.clock.hi,size:6,step:this.data.clock.step},{type:"slider",id:"simspeed",text:"Simulation Delay (ms)",min:0,max:2000,value:0,size:6,step:10,chmore:this.nmify+".fixSpeed(this.value); "}]};Novaol.prototype.simbuttons=function(){return[{name:"reset",text:"Reset",onClick:this.nmify+".reset()",onDblClick:this.nmify+".dblReset()"},{name:"run",text:"Run",onClick:this.nmify+".run()"},{name:"stop",text:"Stop",onClick:this.nmify+".stop()"},{name:"continue",text:"Continue",onClick:this.nmify+".restart()"},{name:"step",text:"Step",onClick:this.nmify+".step()"}]};Novaol.prototype.control=function(e,b,d){var a=this.tag;var c=this.nmify;e.selectAll("."+b).data(d).enter().append("td").each(function(i){if(i.type=="slider"){d3.select(this).append("label").attr("for",i.id+"_slider_"+a).text(function(j){return j.text+": "});d3.select(this).append("input").attr("id",i.id+"_slider_"+a).attr("type","range").attr("name",i.id+"_name_"+a).attr("min",i.min).attr("max",i.max).attr("value",i.value).attr("step",i.step).attr("onchange",(i.change)?i.change:c+".showSliderValue('"+i.id+"_field_"+a+"', this.value); "+((i.chmore)?i.chmore:"")+((i.reset)?c+".reset()":""));d3.select(this).append("span").style("padding-left","5px").append("input").style("text-align","right").attr("id",i.id+"_field_"+a).attr("type","text").attr("size",i.size).attr("value",i.value).attr("readonly",true)}else{if(i.type=="field"){d3.select(this).append("label").attr("for",i.id).text(i.text+": ");d3.select(this).append("input").style("text-align",("readwrite" in i)?"left":"right").attr("id",i.id).attr("type","text").attr("size",i.size).attr("value",i.value).attr("readonly",("readwrite" in i)?null:true)}else{if(i.type=="switch"){var g=d3.select(this).append("table");g.append("tr").append("td").attr("colspan",2).style("text-align","center").text(i.text);var h=g.append("tr");h.append("td").style("padding-left","0px").style("padding-right","5px").style("vertical-align","middle").style("text-align","right").append("label").attr("for",i.id+"_switch_"+a).append("font").attr("color","red").text(i.left);var f=h.append("td").style("padding-left","5px").style("padding-right","0px").style("vertical-align","middle").style("text-align","left");f.append("input").style("visibility","hidden").attr("type","checkbox").attr("id",i.id+"_switch_"+a).attr("name",i.id+"_switch_name_"+a).attr("checked",i.checked).attr("class","switch");f.append("label").attr("for",i.id+"_switch_"+a).append("font").attr("color","green").text(i.right)}}}})};Novaol.prototype.buttons=function(c,a,b){c.selectAll("."+a).data(b).enter().append("button").attr("name",function(e){return e.name}).attr("onClick",function(e){return e.onClick}).text(function(e){return e.text}).each(function(e){if("onDblClick" in e){d3.select(this).attr("onDblClick",e.onDblClick)}})};Novaol.prototype.populate=function(h){if("css" in this.data){d3.select("head").selectAll(".csslinks").data(this.data.css).enter().append("link").attr("rel","stylesheet").attr("type","text/css").attr("href",function(i){return"common/"+i+".css"})}if("cssauto" in this.data){d3.select("head").append("style").text(this.data.cssauto)}d3.select("head").append("title").text(this.gitn(this.data.title));if("wallpaper" in this.data){d3.select("body").attr("background","common/images/"+this.gitn(this.data.wallpaper))}else{if("background_color" in this.data){d3.select("body").style("background-color",this.gitn(this.data.background_color))}}d3.select("#simtitle").text(this.gitn(this.data.title));var f=("simbuttons" in this.data)?this.simbuttons.concat(this.data.simbuttons(this.index)):this.simbuttons();var a=("simcontrols" in this.data)?this.data.simcontrols(this.index):this.simcontrols();var c="#SControls_"+this.tag;if("model_background" in this.data&&this.index in this.data.model_background){d3.select("#"+this.tag).style("background-color",this.gitn(this.data.model_background[this.index]))}if("model_wallpaper" in this.data&&this.index in this.data.model_wallpaper){d3.select("#"+this.tag).style("background","common/images/"+this.gitn(this.data.model_wallpaper[this.index]))}this.control(d3.select(c).append("table").append("tr"),"ncsliders",a);this.buttons(d3.select(c).select("tr").append("td"),"ncbuttons",f);this.control(d3.select(c).select("tr"),"ncsliders",this.timefield());if("modcontrols" in this.data){var e=d3.select("#MControls_"+this.tag);for(var b=0;b<this.data.modcontrols.length;b++){var g=this.data.modcontrols[b];this.control(e.append("table").append("tr"),"controls",g)}}if("visuals" in this.data){if(Array.isArray(this.data.visuals)){var d=this.data.visuals.reverse();for(var b=0;b<d.length;b++){this.data.visuals[b](d3.select("#visuals_"+this.tag),this.project,this.index)}}else{this.data.visuals(d3.select("#visuals_"+this.tag),this.project,this.index)}}if("address" in this.data){if(!("address" in globl)){globl.address=[]}if(Array.isArray(this.data.address)){for(var b=0;b<this.data.address.length;b++){if(globl.address.indexOf(this.data.address[b])<0){globl.address.push(this.data.address[b])}}}else{if(globl.address.indexOf(this.data.address)<0){globl.address.push(this.data.address)}}}if("date" in this.data){d3.select("#modified").text("Last Modified "+this.data.date)}if(h){h()}};Novaol.prototype.signoff=function(){if(!("address" in globl)){return}d3.select("#address").selectAll(".addresses").data(globl.address).enter().append("address").text(function(a){return a})};Novaol.prototype.control_builder=function(){var b={};var f=("simcontrols" in this.data)?this.git0(this.data.simcontrols(index)):this.simcontrols();for(var c=0;c<f.length;c++){var a=f[c];b[a.id]=document.getElementById(a.id+"_"+a.type+"_"+this.tag);b[a.id].value=a.value}if(!("modcontrols" in this.data)){return b}var d=this.data.modcontrols.reduce(function(h,g){return h.concat(g)});for(var c=0;c<d.length;c++){var a=d[c];var e=(a.type=="field")?a.id:a.id+"_"+a.type+"_"+this.tag;b[a.id]=document.getElementById(e);b[a.id].value=a.value}return b};Novaol.prototype.get=function(c){var b=function(k,f){for(var h=0;h<k.length;h++){if(Array.isArray(f)){for(var e=0;e<f.length;e++){ans=b(k.slice(1),f[e]);if(ans==null){continue}return ans}return null}else{if(typeof f=="function"&&h<k.length-1){f=f(this.project,this.index)}if(f==null){return null}var g=k[h];f=f[g]}}return f}.bind(this);var d=c.split(".");var a=b(d,this.data);return a};Novaol.prototype.getAll=function(e){var d=function(m,h){for(var l=0;l<m.length;l++){if(Array.isArray(h)){for(var g=0;g<h.length;g++){a=d(m.slice(1),h[g]);if(a==null){continue}return a}return null}else{if(typeof h=="function"){h=h(this.project,this.index)}if(h==null){return null}var k=m[l];h=h[k]}}return h}.bind(this);var f=e.split(".");var b=d(f,this.data);var a={};for(var c in b){a[c]=b[c]}return a};Novaol.getSyncScriptParams=function(){var a=document.getElementsByTagName("script");var f=a[a.length-1];var d=f;var b=new Object();for(var c=0;c<arguments.length;c++){var e=d.getAttribute(arguments[c]);if(e!=null){b[arguments[c]]=e}}return b};Novaol.recordJSON=function(a){var b=Novaol.getSyncScriptParams("data-project")["data-project"];globl[b]=new Object();a.project=b;globl[b].PData=a};Novaol.recordJS=function(a){var b=Novaol.getSyncScriptParams("data-project")["data-project"];globl[b].main=a};Novaol.prototype.buildHTML=function(){var a=this.tag;var b=d3.select("#"+a);b.append("table").attr("id","SControls_"+a).attr("class","simControlTable");b.append("hr");b.append("table").attr("id","MControls_"+a).attr("class","modControlTable");b.append("hr");b.append("div").attr("id","visuals_"+a).attr("class","novaVisuals")};Novaol.startup=function(b,a){if(!("controls" in globl[b])){globl[b].controls=new Object()}if(!("novaManager" in globl[b])){globl[b].novaManager=new Object()}novaol=new Novaol(globl[b].PData,a);novaol.buildHTML();novaol.populate();globl[b].controls[a]=novaol.control_builder();globl[b].postInterval=novaol.get("postinterval");globl[b].novaManager[a]=novaol.getNovaManager()};Novaol.prototype.getNovaManager=function(){var g=this.project;var b=this.index;var c=this.get("clock.lo");var a=globl[g].controls[b].simhi;var d=this.get("clock.dt");var h=this.get("clock.method");var f=SimGen(globl[g].main,globl[g].controls[b]);var e={clock:new Clock(c,a,d,h),resetter:function(i){e.clock.reset(f)},updater:function(){}};e.clock.postInterval=globl[g].postInterval;e.resetter();ans=NovaManager(e.updater,e.resetter,e.clock,document.getElementById("timeval_"+g+"_"+b),a,d,0,0);return ans};