//     JNovaScript PLugins 0.0.1
//     Plugins For JNovaScript
//     http://novamodeler.com
//     (c) 2014-2015 Richard Salter
//JNovaScript plugins
//Cascade
//Tableau
//Log
//Spy
//Barchart
//Linechart
//Scatterchart
//Table
//Netviewer (grid)
//Agentviewer
//AgentviewerX
//Raster
function PL_Cascade(t,i,s,e){pl_proto.call(this,t,"Cascade",["Initial","In","Converter"],["Out","Element"],[]),null!=s?("Initial"in s&&(this.Initial.exp=s.Initial),"In"in s&&(this.In.exp=s.In),"Converter"in s&&(this.Converter.exp=s.Converter)):this.Converter=function(t){return t},this.count=i.count,this.cascadeDat=[],this.Out.exp=0,this.Element.exp=function(){var t=this.cascadeDat
return function(){return function(i){return t[i]}}}.call(this)
var r=i.vizid+(i.vizid_subscript?"_"+e.id:""),o="function"==typeof i.caption?i.caption(e.id):i.caption
"vizid"in i&&(this.vcascade=cascade("#"+r,this.count,i.columns,i.dsize,i.background,o))}function PL_Tableau(t,i,s,e){pl_proto.call(this,t,"Tableau",[],["m"],[]),this.properties=i
var r=i.vizid+(i.vizid_subscript?"_"+e.id:""),o="function"==typeof i.caption?i.caption(e.id):i.caption
"vizid"in i&&(this.vtableau=tableau("#"+r,i.rows,i.cols,i.rowHeaders,i.columnLabels,i.initial,i.dsize,i.background,o))}function PL_Log(t,i,s){pl_proto.call(this,t,"Log",["inpt"]),null!=s&&"inpt"in s&&(this.inpt.exp=s.inpt),this.properties=i,this.preOrPost="when"in i?i.when:"post",this.svalue="",this.vis=null,i.vizid&&this.visual(i.vizid,i.rows,i.cols)}function PL_Spy(t,i,s){pl_proto.call(this,t,"Spy",["inpt"],["outpt"],["vinit"]),null!=s&&"inpt"in s&&(this.inpt.exp=s.inpt),this.properties=i,this.svalue=0,this.vis=null,i.vizid&&(this.vinit.exp=null==i.init?null!=s&&"inpt"in s?s.inpt:0:i.init,this.visual(i.vizid,i.size))}function PL_Barchart(t,i,s){pl_proto.call(this,t,"Barchart",["inpt"],[],["vinit"]),null!=s&&"inpt"in s&&(this.inpt.exp=s.inpt),this.props=i,"init"in i?this.vinit.exp=i.init:delete this.vinit,this.barchart=barchart("#"+i.vizid,i.width,i.height,i.XAxis,i.YAxis,i.yLabel,i.margin,i.colors,i.caption)}function PL_Linechart(t,i,s){if(pl_proto.call(this,t,"Linechart",["inpt"],[],["vinit"]),null!=s&&"inpt"in s&&(this.inpt.exp=s.inpt),this.props=i,this.myData=new Array,i.compareMode=!("streams"in this.props)||1==i.streams,null==i.init)if("streams"in this.props){for(var e=[],r=0;r<this.props.streams;r++)e.push(0)
this.vinit.exp=e}else this.vinit.exp=0
else this.vinit.exp=i.init
var o="number"==typeof i.hi?i.hi:i.hi.value
this.linechart=linechart("#"+i.vizid,i.width,i.height,i.margin,i.lo,o,i.valueFunc,i.textFunc,null,null,null,null,i.manualColor,i.strokes,i.compareMode,i.initialMode,i.caption,i.legend)}function PL_Scatterchart(t,i,s){pl_proto.call(this,t,"Linechart",["inpt"],[],[]),null!=s&&"inpt"in s&&(this.inpt.exp=s.inpt),this.props=i,this.myData=new Array,this.autogen="autogen"in i?i.autogen:!1
var e="transition"in i?i.transition:!1
"radius"in i||(i.radius=2),"toolTip"in i||(i.toolTip=!1),"margin"in i||(i.margin=null),this.scatterchart=scatterchart("#"+i.vizid,i.width,i.height,i.xLabel,i.yLabel,i.margin,i.radius,i.caption,i.toolTip,e)}function PL_Table(t,i,s){pl_proto.call(this,t,"Table",["inpt"],["blob"],["vinit"]),null!=s&&"inpt"in s&&(this.inpt.exp=s.inpt),this.props=i,this.blobb="",this.blob.exp=function(){return this.blobb}
var e
if("keys"in i)e=i.keys
else{e=[]
for(var r=0;r<i.columns.length-1;r++)e.push(r)
i.keys=e}var o
if("valueFuncs"in i)o=i.valueFuncs
else{o=[]
for(var r in i.keys){var a=i.keys[r],n=function(){var t=a
return function(i){return i[t]}}()
o.push(n)}this.props.valueFuncs=o}"textFunc"in i||(i.textFunc=function(t){return t.time}),this.myData=new Array,this.vinit.exp=null==i.init?s.inpt:i.init,this.trender=drawTable("#"+i.vizid,{width:i.width,height:i.height},o,i.textFunc,i.columns,i.sort,i.sortIdx,i.caption)}function PL_Netviewer(t,i,s){pl_proto.call(this,t,"Netviewer",[],[],[]),null!=s?(this.pins=s,"source"in s&&(this.sourceName=s.source),"nColorOut"in s&&(this.nColorOut=s.nColorOut)):this.pins={},this.props=i,this.fstTime=!0,this.nv=netviewer("#"+i.vizid,i.rows,i.cols,i.unit,i.maxWt,i.linkColor,i.colors,i.fixedMarker,i.background)}function PL_Agentviewer(t,i,s){pl_proto.call(this,t,"Agentviewer",[],[],[]),null!=s?(this.pins=s,"source"in s&&(this.sourceName=s.source),"aColorOut"in s&&(this.aColorOut=s.aColorOut),"aSize"in s&&(this.aSize=s.aSize)):this.pins={},this.props=i,"radius"in i&&(this.radius=i.radius),"colors"in i&&(this.colors=i.colors),"images"in i&&(this.images=i.images)
var e="fill"in i?i.fill:null
this.fstTime=!0,this.av=agentviewer("#"+i.vizid,i.width,i.height,i.unit,i.rows,i.cols,20,this.images?!0:!1,e)}function PL_AgentviewerX(t,i,s){if(pl_proto.call(this,t,"AgentviewerX",[],[],[]),null!=s?(this.pins=s,"source"in s&&(this.sourceName=s.source)):this.pins={},this.props=i,"images"in i&&(this.images=i.images),this.rows=this.props.rows,this.cols=this.props.cols,this.interactive="interactive"in i?i.interactive:!1,this.av=agentviewerx("#"+i.vizid,i.unit,i.rows,i.cols,i.colors,i.transition?i.transition:20,i.toolTip?!0:!1,i.images),this.cBucket=new Object,this.aBucket=new Object,this.fstTime=!0,this.interactive){var e=this.cBucket
for(var r in this.props.cellInit){var o=this.props.cellInit[r]
o.forEach(function(t){e[t]={colorIdx:+r}})}}if(this.acscale=1,this.ccscale=1,"hiAgentColor"in i&&("lowAgentColor"in i||(i.lowAgentColor=0),this.acscale=(i.colors.agent.length-1)/(i.hiAgentColor-i.lowAgentColor)),"hiCellColor"in i&&("lowCellColor"in i||(i.lowCellColor=0),this.ccscale=(i.colors.cell.length-1)/(i.hiCellColor-i.lowCellColor)),this.sscale=function(t){return t},null!=this.pins.aSizeOut){var a=i.largeSize,n=i.smallSize
null!=a&&null!=n&&(this.sscale=function(t,i){return Math.max(2,2*t*(i-n)/(a-n))})}}function PL_Raster(t,i,s){if(pl_proto.call(this,t,"Raster",[],[],[]),null!=s?(this.pins=s,"source"in s&&(this.sourceName=s.source)):this.pins={},this.props=i,"images"in i&&(this.images=i.images),this.rows=this.props.rows,this.cols=this.props.cols,this.interactive="interactive"in i?i.interactive:!1,this.rast=raster("#"+i.vizid,i.unit,i.rows,i.cols,i.colors),this.bucket=new Object,this.fstTime=!0,this.interactive){var e=this.bucket
for(var r in this.props.init){var o=this.props.init[r]
o.forEach(function(t){e[t]={colorIdx:+r}})}}"numColors"in i&&i.colors.splice(i.numColors,i.colors.length-i.numColors),this.scale=1,"hiColor"in i&&("loColor"in i||(i.loColor=0),this.scale=(i.colors.length-1)/(i.hiColor-i.loColor))}function PL_Tabulator(t,i,s){this.properties=i,this.size=i.size,this.start=i.start
for(var e=new Array,r=0;r<this.size;r++)e.push("Out_"+(10>r?"0"+r:r))
pl_proto.call(this,t,"Tabulator",[],e,[]),null!=s&&("source"in s&&(this.sourceName=s.source),"In"in s&&(this.In=s.In)),this.buckets=new Array
for(var r=0;r<this.size;r++)this.buckets[r]=0,this[e[r]].exp=function(){var t=r
return function(){return this.buckets[t]}.bind(this)}.call(this)}pl_proto.prototype.colorPick=function(t,i){if(t in i)return i[t]
var s=Object.keys(i)
if(t<=+s[0])return i[s[0]]
if(t>=+s[s.length-1])return i[s[s.length-1]]
for(var e=0;!(t>=+s[e]&&t<+s[e+1]);)e++
var r=+s[e+1]-+s[e],o=(t-+s[e])/r
clow=d3.rgb(i[s[e]]),chi=d3.rgb(i[s[e+1]])
var a=d3.interpolate(clow,chi)(o)
return a},PL_Cascade.prototype=Object.create(pl_proto.prototype),PL_Cascade.prototype.constructor=PL_Cascade,PL_Cascade.prototype.reset=function(t,i){for(pl_proto.prototype.reset.call(this,t,i),this.Initial.reset(),this.In.reset();this.cascadeDat.length>0;)this.cascadeDat.shift()
if("Initial"in this.scope)for(var s in this.scope.Initial)this.cascadeDat[s]=this.scope.Initial[s]
for(;this.cascadeDat.length>this.count;)this.cascadeDat.pop(this.cascadeDat.length-1)
for(var s=this.cascadeDat.length;s<this.count;s++)this.cascadeDat[s]=0
this.Out.exp=function(){var t=this.cascadeDat
return function(){return t}}.call(this),this.vcascade&&this.vcascade.reset(this.cascadeDat)},PL_Cascade.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i),this.ncascade=[]
for(var s=this.count-1;s>=0;s--)if(0==s)this.ncascade[s]=this.scope.In
else{var e=this.scope.Converter.call(this.cap.scope,this.cascadeDat[s-1],s,this.cascadeDat[s])
this.ncascade[s]=e}},PL_Cascade.prototype.update=function(t,i){pl_proto.prototype.update.call(this,t,i)
for(var s in this.ncascade)this.cascadeDat[s]=this.ncascade[s]
"vcascade"in this&&this.vcascade.update(this.cascadeDat)},PL_Tableau.prototype=Object.create(pl_proto.prototype),PL_Tableau.prototype.constructor=PL_Tableau,PL_Tableau.prototype.reset=function(t,i){pl_proto.prototype.reset.call(this,t,i)
for(var s=[],e=0;e<this.properties.rows;e++){s.push([])
for(var r=0;r<this.properties.cols;r++)s[e][r]="vtableau"in this?this.vtableau.get(e,r):properties.initial[e][r],"string"==typeof s[e][r]&&(s[e][r]=+s[e][r])}this.m.exp=s},PL_Tableau.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i)},PL_Log.prototype=Object.create(pl_proto.prototype),PL_Log.prototype.constructor=PL_Log,PL_Log.prototype.reset=function(t,i){pl_proto.prototype.reset.call(this,t,i),this.inpt.reset(),this.vis&&(this.vis.value="")},PL_Log.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i)
var s=this.scope.inpt
""!=s&&this.vis&&(this.vis.value=this.vis.value+s+"\n")},PL_Log.prototype.visual=function(t,i,s){this.visid=t
var e=d3.select("#"+t)
"caption"in this.properties&&(e=e.append("table").append("tr").append("caption").text(this.properties.caption).append("td")),e.append("textarea").attr("id",t+"_log").attr("readonly",!0).attr("rows",null==i?5:i).attr("cols",null==s?20:s),this.vis=document.getElementById(t+"_log")},PL_Spy.prototype=Object.create(pl_proto.prototype),PL_Spy.prototype.constructor=PL_Spy,PL_Spy.prototype.reset=function(t,i){pl_proto.prototype.reset.call(this,t,i),this.svalue=0,this.inpt.reset(),this.vis&&(this.vinit.reset(),this.svalue=this.vis.value=this.scope.vinit),this.outpt.exp=function(){var t=this.svalue
return function(){return t}}.call(this)},PL_Spy.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i),this.svalue=this.scope.inpt,this.vis&&(this.vis.value=this.svalue),this.outpt.exp=function(){var t=this.svalue
return function(){return t}}.call(this)},PL_Spy.prototype.visual=function(t,i){this.visid=t
var s=d3.select("#"+t)
"caption"in this.properties&&(s=s.append("table").append("tr").append("caption").text(this.properties.caption).append("td")),s.append("input").attr("id",t+"_spy").attr("readonly",!0).attr("size",null==i?5:i).attr("value",""),this.vis=document.getElementById(t+"_spy")},PL_Barchart.prototype=Object.create(pl_proto.prototype),PL_Barchart.prototype.constructor=PL_Barchart,PL_Barchart.prototype.reset=function(t,i){if(pl_proto.prototype.reset.call(this,t,i),"vinit"in this){var s=new Array
for(var e in this.scope.vinit)s.push({x:this.props.XAxis[e],y:this.scope.vinit[e]})
this.barchart.reset(s)}else this.barchart.reset()},PL_Barchart.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i)
var s=new Array
for(var e in this.scope.inpt)s.push({x:this.props.XAxis[e],y:this.scope.inpt[e]})
this.barchart.render(s)},PL_Linechart.prototype=Object.create(pl_proto.prototype),PL_Linechart.prototype.constructor=PL_Linechart,PL_Linechart.prototype.reset=function(t,i){if(pl_proto.prototype.reset.call(this,t,i),this.clock=t,this.displayInterval=this.props.displayInterval||0,"postInterval"in t&&(this.displayInterval=Math.max(t.postInterval,this.displayInterval)),this.myData=new Array,"streams"in this.props){this.vinit.reset()
for(var s=0;s<this.props.streams;s++)this.myData[s]=new Array,this.myData[s].stroke="strokes"in this.props?this.props.strokes[s]:"black",this.myData[s].push({time:t.lo,val:this.scope.vinit[s]})}else this.myData=new Array,this.vinit.reset(),this.myData.stroke="stroke"in this.props?this.props.stroke:"black",this.myData.push({time:t.lo,val:this.scope.vinit})
var e="number"==typeof this.props.hi?this.props.hi:this.props.hi.value
this.linechart.reset({hi:e})},PL_Linechart.prototype.strobe=function(t,i){if(pl_proto.prototype.strobe.call(this,t,i),"streams"in this.props)for(var s=0;s<this.props.streams;s++)this.myData[s].push({time:this.clock.current,val:this.scope.inpt[s]})
else this.myData.push({time:this.clock.current,val:this.scope.inpt})
this.displayInterval>0?this.clock.current%this.displayInterval==0?this.linechart.render(this.myData):this.clock.current>=this.clock.hi-this.clock.dt&&this.linechart.render(this.myData):this.props.runAll?this.clock.current>=this.clock.hi-this.clock.dt&&this.linechart.render(this.myData,"xa"):this.linechart.render(this.myData)},PL_Scatterchart.prototype=Object.create(pl_proto.prototype),PL_Scatterchart.prototype.constructor=PL_Scatterchart,PL_Scatterchart.prototype.reset=function(t,i){pl_proto.prototype.reset.call(this,t,i),this.clock=t,this.displayInterval=this.props.displayInterval||0,"postInterval"in t&&(this.displayInterval=Math.max(t.postInterval,this.displayInterval)),this.autogen&&(this.myData=new Array),this.scatterchart.reset()},PL_Scatterchart.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i)
var s,e=this.scope.inpt
if(this.autogen)this.myData.push({x:+e[0],y:+e[1]}),s=this.myData
else{s=[]
var r=Object.keys(e)
for(var o in r)s.push({x:+r[o],y:e[r[o]]})}this.displayInterval>0?this.clock.current%this.displayInterval==0?this.scatterchart.render(s):this.clock.current>=this.clock.hi-this.clock.dt&&this.scatterchart.render(s):this.props.runAll?this.clock.current>=this.clock.hi-this.clock.dt&&this.scatterchart.render(s):this.scatterchart.render(s)},PL_Table.prototype=Object.create(pl_proto.prototype),PL_Table.prototype.constructor=PL_Table,PL_Table.prototype.reset=function(t,i){if(pl_proto.prototype.reset.call(this,t,i),this.displayInterval=this.props.displayInterval||0,"postInterval"in t&&(this.displayInterval=Math.max(t.postInterval,this.displayInterval)),"csv"in this.props){this.blobb=""
for(var s=this.props.columns,e=0;e<s.length;e++)this.blobb+=s[e]+(e==s.length-1?"\n":",")}this.myData=new Array
var r={time:this.clock.lo}
"csv"in this.props&&(this.blobb+=r.time+","),this.vinit.reset()
for(var e in this.props.keys){var o=this.scope.vinit[e]
r[this.props.keys[e]]=o,"csv"in this.props&&(this.blobb+=o+(e==this.props.keys.length-1?"\n":","))}this.blob.exp=function(){var t=this.blobb
return function(){return t}}.call(this),this.myData.push(r),this.trender=drawTable("#"+this.props.vizid,{width:this.props.width,height:this.props.height},this.props.valueFuncs,this.props.textFunc,this.props.columns,this.clock.isRunAll?"na":this.props.sort,this.props.sortIdx,this.props.caption)},PL_Table.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i)
var s={time:this.clock.current}
"csv"in this.props&&(this.blobb+=s.time+",")
for(var e in this.props.keys){var r=this.scope.inpt[e]
s[this.props.keys[e]]=r,"csv"in this.props&&(this.blobb+=r+(e==this.props.keys.length-1?"\n":","))}this.blob.exp=function(){var t=this.blobb
return function(){return t}}.call(this),this.myData.push(s),this.displayInterval>0?this.clock.current%this.displayInterval==0?this.trender(this.myData):this.clock.current>=this.clock.hi-this.clock.dt&&this.trender(this.myData):this.props.runAll?this.clock.current>=this.clock.hi-this.clock.dt&&this.trender(this.myData):this.trender(this.myData)},PL_Netviewer.prototype=Object.create(pl_proto.prototype),PL_Netviewer.prototype.constructor=PL_Netviewer,PL_Netviewer.prototype.glean=function(){var t=this.nColorOut,i=this.nnsource.changes[t],s=new Array,e=this.nnsource,r="radius"in this.props?this.props.radius:null
return i&&i.forEach(function(i){var o=e.NODES(i),a={id:o.id,wt:o[t]}
r&&(a.r=r),s[i]=a}),s},PL_Netviewer.prototype.reset=function(t,i){pl_proto.prototype.reset.call(this,t,i),this.fstTime&&(this.fstTime=!1,this.nnsource="function"==typeof this.sourceName?this.sourceName.call(this.cap):this.cap[this.sourceName])
var s=this.glean()
this.nv.reset(s,this.nnsource.connexions)},PL_Netviewer.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i)
var s=this.glean()
this.nv.render(s,this.nnsource.connexions)},PL_Agentviewer.prototype=Object.create(pl_proto.prototype),PL_Agentviewer.prototype.constructor=PL_Agentviewer,PL_Agentviewer.prototype.glean=function(){var t=this.avsource.changes.location,i=new Array,s=this.avsource,e=this.aColorOut,r=this.aSize,o=this.colors,a=this.images,n=this.colorPick,c=this.radius,p={}
if(a&&t?t.forEach(function(t){var i=s.AGENTS(t),c=a[i[e]]
if(i){"left"in c&&(c=i.theta>=nsutil.math.mpio2&&i.theta<=nsutil.math.pio2?c.right:c.left)
var h={id:i.id,cx:i.x,cy:i.y,wrapped:i.wrapped,image:c}
if(e&&o&&(h.col=n(i[e],o)),r){var l=i[r],u={src:h.image.src,size:[l*h.image.size[0],l*h.image.size[1]]}
h.image=u}p[t]=h}}):t&&t.forEach(function(t){var i=s.AGENTS(t)
if(i){var a={id:i.id,cx:i.x,cy:i.y,wrapped:i.wrapped}
e&&o&&(a.col=n(i[e],o)),r?a.radius=i[r]:c&&(a.r=c),p[t]=a}}),e&&o){var h=this.avsource.changes[e]
h&&h.forEach(function(t){var i=s.AGENTS(t)
if(!p[t]){var r={id:i.id,cx:i.x,cy:i.y,wrapped:i.wrapped,col:n(i[e],o)}
p[t]=r}})}if(r){var h=this.avsource.changes[r]
h&&h.forEach(function(t){var i=s.AGENTS(t)
if(!p[t]){var e
if(a){var o=i[r],n={src:e.image.src,size:[o*e.image.size[0],o*e.image.size[1]]}
e={id:i.id,cx:i.x,cy:i.y,wrapped:i.wrapped,image:n}}else e={id:i.id,cx:i.x,cy:i.y,wrapped:i.wrapped,radius:i[r]}
p[t]=e}})}for(var l in p)i.push(p[l])
return i},PL_Agentviewer.prototype.reset=function(t,i){pl_proto.prototype.reset.call(this,t,i),this.fstTime&&(this.fstTime=!1,this.avsource="function"==typeof this.sourceName?this.sourceName.call(this.cap):this.cap[this.sourceName])
var s=this.glean()
this.av.reset(s)},PL_Agentviewer.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i)
var s=this.avsource,e=this.avsource.changes._births_.map(function(t){var i=s.AGENTS(t)
return{id:i.id,cx:i.x,cy:i.y}}),r=this.avsource.changes._deaths_,o=this.glean()
this.av.create(e),this.av.kill(r),this.av.render(o)},PL_AgentviewerX.prototype=Object.create(pl_proto.prototype),PL_AgentviewerX.prototype.constructor=PL_AgentviewerX,PL_AgentviewerX.prototype.initA=function(){for(var t=new Array,i=this.pins.aColorOut,s=this.pins.aSizeOut,e=this.props.radius,r=this.sscale,o=this.acscale,a=(this.ccscale,0);a<this.source.agentvector.count;a++){var n=this.source.agentvector.AGENTS(a)
t.push({id:n.id,cx:n.self.x,cy:n.self.y,r:r(e,n[s]),colorIdx:o*n[i],wrapped:n.wrapped})}return t},PL_AgentviewerX.prototype.gleanA=function(){var t=this.source.agentvector,i=t.changes.location,s=new Array,e=this.pins.aColorOut,r=this.props.radius,o=this.pins.aSizeOut,a=this.sscale,n=this.acscale
this.ccscale
i&&i.forEach(function(i){var c=t.AGENTS(i)
s.push({id:c.id,cx:c.self.x,cy:c.self.y,r:a(r,c[o]),colorIdx:n*c[e],wrapped:c.wrapped})})
var c=t.changes[e]
return c&&c.forEach(function(c){if(!i[c]){var p=t.AGENTS(c)
s.push({id:p.id,cx:p.self.x,cy:p.self.y,r:a(r,p[o]),colorIdx:n*p[e],wrapped:p.wrapped})}}),s},PL_AgentviewerX.prototype.initC=function(){for(var t=new Array,i=this.pins.cColorOut,s=(this.acscale,this.ccscale),e=0;e<this.rows;e++)for(var r=0;r<this.cols;r++){var o=this.source.cellmatrix.CELLS(e,r)
t.push({id:o.id,r:o.row,c:o.col,colorIdx:s*o[i]})}return t},PL_AgentviewerX.prototype.gleanC=function(){var t=new Array,i=this.pins.cColorOut,s=this.source.cellmatrix,e=s.changes[i],r=(this.acscale,this.ccscale)
return e?(e.forEach(function(e){var o=s.CELLS(e)
t.push({id:o.id,r:o.row,c:o.col,colorIdx:r*o[i]})}),t):t},PL_AgentviewerX.prototype.prereset=function(t){if(pl_proto.prototype.prereset.call(this,t),this.fstTime&&(this.fstTime=!1,this.source="function"==typeof this.sourceName?this.sourceName.call(this.cap):this.cap[this.sourceName],this.interactive)){var i=this
this.aBucket=this.props.agentInit,this.source.cellmatrix[this.pins.cColorIn]=function(){var t=0,s=i.cBucket[this.id]
return s&&(t=s.colorIdx),t},this.source.agentvector[this.pins.aColorIn]=function(){var t=0,s=i.aBucket[this.id]
return s&&(t=s.colorIdx),t}}if(this.interactive){var s=this.av.getInitCellBucket()
for(var e in s)s[e].colorIdx?this.cBucket[e]=s[e]:delete this.cBucket[e]
var r=this.av.getInitAgentBucket()
for(var e in r)this.aBucket[e]=r[e]
this.source.agentvector.regenerate(this.aBucket)}},PL_AgentviewerX.prototype.reset=function(t,i){pl_proto.prototype.reset.call(this,t)
var s=this.initA(),e=this.initC()
this.av.reset(s,e)},PL_AgentviewerX.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i)
var s=this.source.agentvector.changes._births_.map(function(t){var i=this.source.agentvector.AGENTS(t)
return{id:i.id,cx:i.x,cy:i.y}}),e=this.source.agentvector.changes._deaths_,r=this.gleanA(),o=this.gleanC()
this.av.create(s),this.av.kill(e),this.av.render(r,o)},PL_Raster.prototype=Object.create(pl_proto.prototype),PL_Raster.prototype.constructor=PL_Raster,PL_Raster.prototype.init=function(){for(var t=new Array,i=this.pins.colorOut,s=this.scale,e=0;e<this.rows;e++)for(var r=0;r<this.cols;r++){var o=this.source.CELLS(e,r)
t.push({id:o.id,r:o.row,c:o.col,colorIdx:s*o[i]})}return t},PL_Raster.prototype.glean=function(){var t=new Array,i=this.pins.colorOut,s=this.source,e=s.changes[i],r=this.scale
return e?(e.forEach(function(e){var o=s.CELLS(e)
t.push({id:o.id,r:o.row,c:o.col,colorIdx:r*o[i]})}),t):t},PL_Raster.prototype.prereset=function(t){if(pl_proto.prototype.prereset.call(this,t),this.fstTime&&(this.fstTime=!1,this.source="function"==typeof this.sourceName?this.sourceName.call(this.cap):this.cap[this.sourceName],this.interactive)){var i=this
this.source[this.pins.colorIn]=function(){var t=0,s=i.bucket[this.id]
return s&&(t=s.colorIdx),t}}if(this.interactive){var s=this.rast.getInitBucket()
for(var e in s)s[e].colorIdx?this.bucket[e]=s[e]:delete this.bucket[e]}},PL_Raster.prototype.reset=function(t,i){pl_proto.prototype.reset.call(this,t)
var s=this.init()
this.rast.reset(s)},PL_Raster.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i)
var s=this.glean()
this.rast.render(s)},PL_Tabulator.prototype=Object.create(pl_proto.prototype),PL_Tabulator.prototype.constructor=PL_Tabulator,PL_Tabulator.prototype.reset=function(t,i){pl_proto.prototype.reset.call(this,t,i),this.source="function"==typeof this.sourceName?this.sourceName.call(this.cap):this.cap[this.sourceName],this.kind=this.source.kind
for(var s=this.In,e=this.buckets,r=this.start,o=0;o<e.length;o++)e[o]=0
switch(this.kind){case"CellMatrix":cm=this.source,this.State=new Object
for(var o=0;o<this.source.rows;o++)for(var a=0;a<this.source.cols;a++){var n=cm.CELLS(o,a),c=n[s]
this.State["C"+o+":"+a]=c
var p=c-r
p>=0&&p<e.length&&e[p]++}}},PL_Tabulator.prototype.strobe=function(t,i){pl_proto.prototype.strobe.call(this,t,i)
var s=this.In,e=this.source.changes[s]
if(e){var r=this.start,o=this.buckets,a=this.State
switch(this.kind){case"CellMatrix":cm=this.source,e.forEach(function(t){var i=cm.CELLS(t),e=i[s],n=e-r,c=a[t],p=null==c?null:c-r
n>=0&&n<o.length&&o[n]++,null!=p&&p>=0&&p<o.length&&o[p]--,a[t]=e})}}}
