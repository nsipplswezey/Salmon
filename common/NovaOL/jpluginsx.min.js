pl_proto.prototype.colorPick=function(h,b){if(h in b){return b[h]}var f=Object.keys(b);if(h<=+f[0]){return b[f[0]]}if(h>=+f[f.length-1]){return b[f[f.length-1]]}var e=0;while(!(h>=+f[e]&&h<+f[e+1])){e++}var g=(+f[e+1])-(+f[e]);var a=(h-(+f[e]))/g;clow=d3.rgb(b[f[e]]);chi=d3.rgb(b[f[e+1]]);var c=d3.interpolate(clow,chi)(a);return c};function PL_Cascade(d,e,f,c){pl_proto.call(this,d,"Cascade",["Initial","In","Converter"],["Out","Element"],[]);if(f!=null){if("Initial" in f){this.Initial.exp=f.Initial}if("In" in f){this.In.exp=f.In}if("Converter" in f){this.Converter.exp=f.Converter}}else{this.Converter=function(g){return g}}this.count=e.count;this.cascadeDat=[];this.Out.exp=0;this.Element.exp=(function(){var g=this.cascadeDat;return function(){return function(h){return g[h]}}}).call(this);var b=e.vizid+((e.vizid_subscript)?"_"+c.id:"");var a=(typeof e.caption=="function")?e.caption(c.id):e.caption;if("vizid" in e){this.vcascade=cascade("#"+b,this.count,e.columns,e.dsize,e.background,a)}}PL_Cascade.prototype=Object.create(pl_proto.prototype);PL_Cascade.prototype.constructor=PL_Cascade;PL_Cascade.prototype.reset=function(b,c){pl_proto.prototype.reset.call(this,b,c);this.Initial.reset();this.In.reset();while(this.cascadeDat.length>0){this.cascadeDat.shift()}if("Initial" in this.scope){for(var a in this.scope.Initial){this.cascadeDat[a]=this.scope.Initial[a]}}while(this.cascadeDat.length>this.count){this.cascadeDat.pop(this.cascadeDat.length-1)}for(var a=this.cascadeDat.length;a<this.count;a++){this.cascadeDat[a]=0}this.Out.exp=(function(){var d=this.cascadeDat;return function(){return d}}).call(this);if(this.vcascade){this.vcascade.reset(this.cascadeDat)}};PL_Cascade.prototype.strobe=function(b,d){pl_proto.prototype.strobe.call(this,b,d);this.ncascade=[];for(var a=this.count-1;a>=0;a--){if(a==0){this.ncascade[a]=this.scope.In}else{var c=this.scope.Converter.call(this.cap.scope,this.cascadeDat[a-1],a,this.cascadeDat[a]);this.ncascade[a]=c}}};PL_Cascade.prototype.update=function(b,c){pl_proto.prototype.update.call(this,b,c);for(var a in this.ncascade){this.cascadeDat[a]=this.ncascade[a]}if("vcascade" in this){this.vcascade.update(this.cascadeDat)}};function PL_Tableau(d,e,f,c){pl_proto.call(this,d,"Tableau",[],["m"],[]);this.properties=e;var b=e.vizid+((e.vizid_subscript)?"_"+c.id:"");var a=(typeof e.caption=="function")?e.caption(c.id):e.caption;if("vizid" in e){this.vtableau=tableau("#"+b,e.rows,e.cols,e.rowHeaders,e.columnLabels,e.initial,e.dsize,e.background,a)}}PL_Tableau.prototype=Object.create(pl_proto.prototype);PL_Tableau.prototype.constructor=PL_Tableau;PL_Tableau.prototype.reset=function(d,e){pl_proto.prototype.reset.call(this,d,e);var a=[];for(var c=0;c<this.properties.rows;c++){a.push([]);for(var b=0;b<this.properties.cols;b++){a[c][b]=("vtableau" in this)?this.vtableau.get(c,b):properties.initial[c][b];if(typeof a[c][b]=="string"){a[c][b]=+a[c][b]}}}this.m.exp=a};PL_Tableau.prototype.strobe=function(a,b){pl_proto.prototype.strobe.call(this,a,b)};function PL_Log(a,b,c){pl_proto.call(this,a,"Log",["inpt"]);if(c!=null&&"inpt" in c){this.inpt.exp=c.inpt}this.properties=b;this.preOrPost=("when" in b)?b.when:"post";this.svalue="";this.vis=null;if(b.vizid){this.visual(b.vizid,b.rows,b.cols)}}PL_Log.prototype=Object.create(pl_proto.prototype);PL_Log.prototype.constructor=PL_Log;PL_Log.prototype.reset=function(a,b){pl_proto.prototype.reset.call(this,a,b);this.inpt.reset();if(this.vis){this.vis.value=""}};PL_Log.prototype.strobe=function(a,b){pl_proto.prototype.strobe.call(this,a,b);var c=this.scope.inpt;if(c==""){return}if(this.vis){this.vis.value=this.vis.value+c+"\n"}};PL_Log.prototype.visual=function(e,c,d){this.visid=e;var b=d3.select("#"+e);var a=null;if("caption" in this.properties){b=b.append("table").append("tr").append("caption").text(this.properties.caption).append("td")}b.append("textarea").attr("id",e+"_log").attr("readonly",true).attr("rows",(c==null)?5:c).attr("cols",(d==null)?20:d);this.vis=document.getElementById(e+"_log")};function PL_Spy(a,b,c){pl_proto.call(this,a,"Spy",["inpt"],["outpt"],["vinit"]);if(c!=null&&"inpt" in c){this.inpt.exp=c.inpt}this.properties=b;this.svalue=0;this.vis=null;if(b.vizid){this.vinit.exp=(b.init==null)?((c!=null&&"inpt" in c)?c.inpt:0):b.init;this.visual(b.vizid,b.size)}}PL_Spy.prototype=Object.create(pl_proto.prototype);PL_Spy.prototype.constructor=PL_Spy;PL_Spy.prototype.reset=function(a,b){pl_proto.prototype.reset.call(this,a,b);this.svalue=0;this.inpt.reset();if(this.vis){this.vinit.reset();this.svalue=this.vis.value=this.scope.vinit}this.outpt.exp=function(){var c=this.svalue;return function(){return c}}.call(this)};PL_Spy.prototype.strobe=function(a,b){pl_proto.prototype.strobe.call(this,a,b);this.svalue=this.scope.inpt;if(this.vis){this.vis.value=this.svalue}this.outpt.exp=function(){var c=this.svalue;return function(){return c}}.call(this)};PL_Spy.prototype.visual=function(d,a){this.visid=d;var c=d3.select("#"+d);var b=null;if("caption" in this.properties){c=c.append("table").append("tr").append("caption").text(this.properties.caption).append("td")}c.append("input").attr("id",d+"_spy").attr("readonly",true).attr("size",(a==null)?5:a).attr("value","");this.vis=document.getElementById(d+"_spy")};function PL_Barchart(a,b,c){pl_proto.call(this,a,"Barchart",["inpt"],[],["vinit"]);if(c!=null&&"inpt" in c){this.inpt.exp=c.inpt}this.props=b;if("init" in b){this.vinit.exp=b.init}else{delete (this.vinit)}this.barchart=barchart("#"+b.vizid,b.width,b.height,b.XAxis,b.YAxis,b.yLabel,b.margin,b.colors,b.caption)}PL_Barchart.prototype=Object.create(pl_proto.prototype);PL_Barchart.prototype.constructor=PL_Barchart;PL_Barchart.prototype.reset=function(b,c){pl_proto.prototype.reset.call(this,b,c);if("vinit" in this){var d=new Array();for(var a in this.scope.vinit){d.push({x:this.props.XAxis[a],y:this.scope.vinit[a]})}this.barchart.reset(d)}else{this.barchart.reset()}};PL_Barchart.prototype.strobe=function(b,c){pl_proto.prototype.strobe.call(this,b,c);var d=new Array();for(var a in this.scope.inpt){d.push({x:this.props.XAxis[a],y:this.scope.inpt[a]})}this.barchart.render(d)};function PL_Linechart(b,e,f){pl_proto.call(this,b,"Linechart",["inpt"],[],["vinit"]);if(f!=null&&"inpt" in f){this.inpt.exp=f.inpt}this.props=e;this.myData=new Array();e.compareMode=(!("streams" in this.props)||e.streams==1);if(e.init==null){if("streams" in this.props){var d=[];for(var c=0;c<this.props.streams;c++){d.push(0)}this.vinit.exp=d}else{this.vinit.exp=0}}else{this.vinit.exp=e.init}var a=(typeof e.hi=="number")?e.hi:e.hi.value;this.linechart=linechart("#"+e.vizid,e.width,e.height,e.margin,e.lo,a,e.valueFunc,e.textFunc,null,null,null,null,e.manualColor,e.strokes,e.compareMode,e.initialMode,e.caption,e.legend)}PL_Linechart.prototype=Object.create(pl_proto.prototype);PL_Linechart.prototype.constructor=PL_Linechart;PL_Linechart.prototype.reset=function(c,d){pl_proto.prototype.reset.call(this,c,d);this.clock=c;this.displayInterval=this.props.displayInterval||0;if("postInterval" in c){this.displayInterval=Math.max(c.postInterval,this.displayInterval)}this.myData=new Array();if("streams" in this.props){this.vinit.reset();for(var b=0;b<this.props.streams;b++){this.myData[b]=new Array();this.myData[b].stroke=("strokes" in this.props)?this.props.strokes[b]:"black";this.myData[b].push({time:c.lo,val:this.scope.vinit[b]})}}else{this.myData=new Array();this.vinit.reset();this.myData.stroke=("stroke" in this.props)?this.props.stroke:"black";this.myData.push({time:c.lo,val:this.scope.vinit})}var a=(typeof this.props.hi=="number")?this.props.hi:this.props.hi.value;this.linechart.reset({hi:a})};PL_Linechart.prototype.strobe=function(b,c){pl_proto.prototype.strobe.call(this,b,c);if("streams" in this.props){for(var a=0;a<this.props.streams;a++){this.myData[a].push({time:this.clock.current,val:this.scope.inpt[a]})}}else{this.myData.push({time:this.clock.current,val:this.scope.inpt})}if(this.displayInterval>0){if(this.clock.current%this.displayInterval==0){this.linechart.render(this.myData)}else{if(this.clock.current>=this.clock.hi-this.clock.dt){this.linechart.render(this.myData)}}}else{if(this.props.runAll){if(this.clock.current>=this.clock.hi-this.clock.dt){this.linechart.render(this.myData,"xa")}}else{this.linechart.render(this.myData)}}};function PL_Scatterchart(a,b,c){pl_proto.call(this,a,"Linechart",["inpt"],[],[]);if(c!=null&&"inpt" in c){this.inpt.exp=c.inpt}this.props=b;this.myData=new Array();this.autogen=("autogen" in b)?b.autogen:false;var d=("transition" in b)?b.transition:false;if(!("radius" in b)){b.radius=2}if(!("toolTip" in b)){b.toolTip=false}if(!("margin" in b)){b.margin=null}this.scatterchart=scatterchart("#"+b.vizid,b.width,b.height,b.xLabel,b.yLabel,b.margin,b.radius,b.caption,b.toolTip,d)}PL_Scatterchart.prototype=Object.create(pl_proto.prototype);PL_Scatterchart.prototype.constructor=PL_Scatterchart;PL_Scatterchart.prototype.reset=function(a,b){pl_proto.prototype.reset.call(this,a,b);this.clock=a;this.displayInterval=this.props.displayInterval||0;if("postInterval" in a){this.displayInterval=Math.max(a.postInterval,this.displayInterval)}if(this.autogen){this.myData=new Array()}this.scatterchart.reset()};PL_Scatterchart.prototype.strobe=function(c,d){pl_proto.prototype.strobe.call(this,c,d);var a=this.scope.inpt;var f;if(this.autogen){this.myData.push({x:+a[0],y:+a[1]});f=this.myData}else{f=[];var e=Object.keys(a);for(var b in e){f.push({x:+e[b],y:a[e[b]]})}}if(this.displayInterval>0){if(this.clock.current%this.displayInterval==0){this.scatterchart.render(f)}else{if(this.clock.current>=this.clock.hi-this.clock.dt){this.scatterchart.render(f)}}}else{if(this.props.runAll){if(this.clock.current>=this.clock.hi-this.clock.dt){this.scatterchart.render(f)}}else{this.scatterchart.render(f)}}};function PL_Table(a,d,j){pl_proto.call(this,a,"Table",["inpt"],["blob"],["vinit"]);if(j!=null&&"inpt" in j){this.inpt.exp=j.inpt}this.props=d;this.blobb="";this.blob.exp=function(){return this.blobb};var e;if("keys" in d){e=d.keys}else{e=[];for(var c=0;c<d.columns.length-1;c++){e.push(c)}d.keys=e}var h;if("valueFuncs" in d){h=d.valueFuncs}else{h=[];for(var c in d.keys){var b=d.keys[c];var g=(function(){var f=b;return function(i){return i[f]}})();h.push(g)}this.props.valueFuncs=h}if(!("textFunc" in d)){d.textFunc=function(f){return f.time}}this.myData=new Array();this.vinit.exp=(d.init==null)?j.inpt:d.init;this.trender=drawTable("#"+d.vizid,{width:d.width,height:d.height},h,d.textFunc,d.columns,d.sort,d.sortIdx,d.caption)}PL_Table.prototype=Object.create(pl_proto.prototype);PL_Table.prototype.constructor=PL_Table;PL_Table.prototype.reset=function(b,c){pl_proto.prototype.reset.call(this,b,c);this.displayInterval=this.props.displayInterval||0;if("postInterval" in b){this.displayInterval=Math.max(b.postInterval,this.displayInterval)}if("csv" in this.props){this.blobb="";var e=this.props.columns;for(var a=0;a<e.length;a++){this.blobb+=(e[a]+((a==e.length-1)?"\n":","))}}this.myData=new Array();var d={time:this.clock.lo};if("csv" in this.props){this.blobb+=(d.time+",")}this.vinit.reset();for(var a in this.props.keys){var f=this.scope.vinit[a];d[this.props.keys[a]]=f;if("csv" in this.props){this.blobb+=(f+((a==this.props.keys.length-1)?"\n":","))}}this.blob.exp=(function(){var g=this.blobb;return function(){return g}}).call(this);this.myData.push(d);this.trender=drawTable("#"+this.props.vizid,{width:this.props.width,height:this.props.height},this.props.valueFuncs,this.props.textFunc,this.props.columns,(this.clock.isRunAll)?"na":this.props.sort,this.props.sortIdx,this.props.caption)};PL_Table.prototype.strobe=function(b,c){pl_proto.prototype.strobe.call(this,b,c);var d={time:this.clock.current};if("csv" in this.props){this.blobb+=(d.time+",")}for(var a in this.props.keys){var e=this.scope.inpt[a];d[this.props.keys[a]]=e;if("csv" in this.props){this.blobb+=(e+((a==this.props.keys.length-1)?"\n":","))}}this.blob.exp=(function(){var f=this.blobb;return function(){return f}}).call(this);this.myData.push(d);if(this.displayInterval>0){if(this.clock.current%this.displayInterval==0){this.trender(this.myData)}else{if(this.clock.current>=this.clock.hi-this.clock.dt){this.trender(this.myData)}}}else{if(this.props.runAll){if(this.clock.current>=this.clock.hi-this.clock.dt){this.trender(this.myData)}}else{this.trender(this.myData)}}};function PL_Netviewer(a,b,c){pl_proto.call(this,a,"Netviewer",[],[],[]);if(c!=null){this.pins=c;if("source" in c){this.sourceName=c.source}if("nColorOut" in c){this.nColorOut=c.nColorOut}}else{this.pins={}}this.props=b;this.fstTime=true;this.nv=netviewer("#"+b.vizid,b.rows,b.cols,b.unit,b.maxWt,b.linkColor,b.colors,b.fixedMarker,b.background)}PL_Netviewer.prototype=Object.create(pl_proto.prototype);PL_Netviewer.prototype.constructor=PL_Netviewer;PL_Netviewer.prototype.glean=function(){var d=this.nColorOut;var e=this.nnsource.changes[d];var c=new Array();var b=this.nnsource;var a=("radius" in this.props)?this.props.radius:null;if(e){e.forEach(function(h){var g=b.NODES(h);var f={id:g.id,wt:g[d]};if(a){f.r=a}c[h]=f})}return c};PL_Netviewer.prototype.reset=function(a,b){pl_proto.prototype.reset.call(this,a,b);if(this.fstTime){this.fstTime=false;this.nnsource=(typeof this.sourceName=="function")?this.sourceName.call(this.cap):this.cap[this.sourceName]}var c=this.glean();this.nv.reset(c,this.nnsource.connexions)};PL_Netviewer.prototype.strobe=function(a,b){pl_proto.prototype.strobe.call(this,a,b);var c=this.glean();this.nv.render(c,this.nnsource.connexions)};function PL_Agentviewer(a,b,d){pl_proto.call(this,a,"Agentviewer",[],[],[]);if(d!=null){this.pins=d;if("source" in d){this.sourceName=d.source}if("aColorOut" in d){this.aColorOut=d.aColorOut}if("aSize" in d){this.aSize=d.aSize}}else{this.pins={}}this.props=b;if("radius" in b){this.radius=b.radius}if("colors" in b){this.colors=b.colors}if("images" in b){this.images=b.images}var c=("fill" in b)?b.fill:null;this.fstTime=true;this.av=agentviewer("#"+b.vizid,b.width,b.height,b.unit,b.rows,b.cols,20,(this.images)?true:false,c)}PL_Agentviewer.prototype=Object.create(pl_proto.prototype);PL_Agentviewer.prototype.constructor=PL_Agentviewer;PL_Agentviewer.prototype.glean=function(){var k=this.avsource.changes.location;var l=new Array();var j=this.avsource;var d=this.aColorOut;var m=this.aSize;var a=this.colors;var g=this.images;var b=this.colorPick;var f=this.radius;var e={};if(g&&k){k.forEach(function(r){var q=j.AGENTS(r);var p=g[q[d]];if(q){if("left" in p){p=(q.theta>=nsutil.math.mpio2&&q.theta<=nsutil.math.pio2)?p.right:p.left}var o={id:q.id,cx:q.x,cy:q.y,wrapped:q.wrapped,image:p};if(d&&a){o.col=b(q[d],a)}if(m){var n=q[m];var i={src:o.image.src,size:[n*o.image.size[0],n*o.image.size[1]]};o.image=i}e[r]=o}})}else{if(k){k.forEach(function(o){var n=j.AGENTS(o);if(n){var i={id:n.id,cx:n.x,cy:n.y,wrapped:n.wrapped};if(d&&a){i.col=b(n[d],a)}if(m){i.radius=n[m]}else{if(f){i.r=f}}e[o]=i}})}}if(d&&a){var h=this.avsource.changes[d];if(h){h.forEach(function(o){var n=j.AGENTS(o);if(!e[o]){var i={id:n.id,cx:n.x,cy:n.y,wrapped:n.wrapped,col:b(n[d],a)};e[o]=i}})}}if(m){var h=this.avsource.changes[m];if(h){h.forEach(function(q){var p=j.AGENTS(q);if(!e[q]){var o;if(g){var n=p[m];var i={src:o.image.src,size:[n*o.image.size[0],n*o.image.size[1]]};o={id:p.id,cx:p.x,cy:p.y,wrapped:p.wrapped,image:i}}else{o={id:p.id,cx:p.x,cy:p.y,wrapped:p.wrapped,radius:p[m]}}e[q]=o}})}}for(var c in e){l.push(e[c])}return l};PL_Agentviewer.prototype.reset=function(a,b){pl_proto.prototype.reset.call(this,a,b);if(this.fstTime){this.fstTime=false;this.avsource=(typeof this.sourceName=="function")?this.sourceName.call(this.cap):this.cap[this.sourceName]}var c=this.glean();this.av.reset(c)};PL_Agentviewer.prototype.strobe=function(a,b){pl_proto.prototype.strobe.call(this,a,b);var e=this.avsource;var d=this.avsource.changes._births_.map(function(h){var g=e.AGENTS(h);return{id:g.id,cx:g.x,cy:g.y}});var f=this.avsource.changes._deaths_;var c=this.glean();this.av.create(d);this.av.kill(f);this.av.render(c)};function PL_AgentviewerX(b,e,f){pl_proto.call(this,b,"AgentviewerX",[],[],[]);if(f!=null){this.pins=f;if("source" in f){this.sourceName=f.source}}else{this.pins={}}this.props=e;if("images" in e){this.images=e.images}this.rows=this.props.rows;this.cols=this.props.cols;this.interactive=("interactive" in e)?e.interactive:false;this.av=agentviewerx("#"+e.vizid,e.unit,e.rows,e.cols,e.colors,(e.transition)?e.transition:20,(e.toolTip)?true:false,e.images);this.cBucket=new Object();this.aBucket=new Object();this.fstTime=true;if(this.interactive){var h=this.cBucket;for(var c in this.props.cellInit){var g=this.props.cellInit[c];g.forEach(function(i){h[i]={colorIdx:+c}})}}this.acscale=1;this.ccscale=1;if("hiAgentColor" in e){if(!("lowAgentColor" in e)){e.lowAgentColor=0}this.acscale=(e.colors.agent.length-1)/(e.hiAgentColor-e.lowAgentColor)}if("hiCellColor" in e){if(!("lowCellColor" in e)){e.lowCellColor=0}this.ccscale=(e.colors.cell.length-1)/(e.hiCellColor-e.lowCellColor)}this.sscale=function(i){return i};if(this.pins.aSizeOut!=null){var a=e.largeSize;var d=e.smallSize;if(a!=null&&d!=null){this.sscale=function(i,j){return Math.max(2,2*i*(j-d)/(a-d))}}}}PL_AgentviewerX.prototype=Object.create(pl_proto.prototype);PL_AgentviewerX.prototype.constructor=PL_AgentviewerX;PL_AgentviewerX.prototype.initA=function(){var j=new Array();var h=this.pins.aColorOut;var g=this.pins.aSizeOut;var f=this.props.radius;var e=this.sscale;var a=this.acscale;var c=this.ccscale;for(var d=0;d<this.source.agentvector.count;d++){var b=this.source.agentvector.AGENTS(d);j.push({id:b.id,cx:b.self.x,cy:b.self.y,r:e(f,b[g]),colorIdx:a*b[h],wrapped:b.wrapped})}return j};PL_AgentviewerX.prototype.gleanA=function(){var a=this.source.agentvector;var i=a.changes.location;var j=new Array();var g=this.pins.aColorOut;var e=this.props.radius;var f=this.pins.aSizeOut;var d=this.sscale;var b=this.acscale;var c=this.ccscale;if(i){i.forEach(function(l){var k=a.AGENTS(l);j.push({id:k.id,cx:k.self.x,cy:k.self.y,r:d(e,k[f]),colorIdx:b*k[g],wrapped:k.wrapped})})}var h=a.changes[g];if(h){h.forEach(function(l){if(!i[l]){var k=a.AGENTS(l);j.push({id:k.id,cx:k.self.x,cy:k.self.y,r:d(e,k[f]),colorIdx:b*k[g],wrapped:k.wrapped})}})}return j};PL_AgentviewerX.prototype.initC=function(){var b=new Array();var a=this.pins.cColorOut;var g=this.acscale;var e=this.ccscale;for(var d=0;d<this.rows;d++){for(var c=0;c<this.cols;c++){var f=this.source.cellmatrix.CELLS(d,c);b.push({id:f.id,r:f.row,c:f.col,colorIdx:e*f[a]})}}return b};PL_AgentviewerX.prototype.gleanC=function(){var c=new Array();var b=this.pins.cColorOut;var a=this.source.cellmatrix;var e=a.changes[b];var f=this.acscale;var d=this.ccscale;if(!e){return c}e.forEach(function(h){var g=a.CELLS(h);c.push({id:g.id,r:g.row,c:g.col,colorIdx:d*g[b]})});return c};PL_AgentviewerX.prototype.prereset=function(b){pl_proto.prototype.prereset.call(this,b);if(this.fstTime){this.fstTime=false;this.source=(typeof this.sourceName=="function")?this.sourceName.call(this.cap):this.cap[this.sourceName];if(this.interactive){var c=this;this.aBucket=this.props.agentInit;this.source.cellmatrix[this.pins.cColorIn]=function(){var f=0;var g=c.cBucket[this.id];if(g){f=g.colorIdx}return f};this.source.agentvector[this.pins.aColorIn]=function(){var f=0;var g=c.aBucket[this.id];if(g){f=g.colorIdx}return f}}}if(this.interactive){var a=this.av.getInitCellBucket();for(var e in a){if(a[e].colorIdx){this.cBucket[e]=a[e]}else{(delete this.cBucket[e])}}var d=this.av.getInitAgentBucket();for(var e in d){this.aBucket[e]=d[e]}this.source.agentvector.regenerate(this.aBucket)}};PL_AgentviewerX.prototype.reset=function(c,d){pl_proto.prototype.reset.call(this,c);var b=this.initA();var a=this.initC();this.av.reset(b,a)};PL_AgentviewerX.prototype.strobe=function(c,d){pl_proto.prototype.strobe.call(this,c,d);var e=this.source.agentvector.changes._births_.map(function(h){var g=this.source.agentvector.AGENTS(h);return{id:g.id,cx:g.x,cy:g.y}});var f=this.source.agentvector.changes._deaths_;var b=this.gleanA();var a=this.gleanC();this.av.create(e);this.av.kill(f);this.av.render(b,a)};function PL_Raster(a,c,d){pl_proto.call(this,a,"Raster",[],[],[]);if(d!=null){this.pins=d;if("source" in d){this.sourceName=d.source}}else{this.pins={}}this.props=c;if("images" in c){this.images=c.images}this.rows=this.props.rows;this.cols=this.props.cols;this.interactive=("interactive" in c)?c.interactive:false;this.rast=raster("#"+c.vizid,c.unit,c.rows,c.cols,c.colors);this.bucket=new Object();this.fstTime=true;if(this.interactive){var f=this.bucket;for(var b in this.props.init){var e=this.props.init[b];e.forEach(function(g){f[g]={colorIdx:+b}})}}if("numColors" in c){c.colors.splice(c.numColors,c.colors.length-c.numColors)}this.scale=1;if("hiColor" in c){if(!("loColor" in c)){c.loColor=0}this.scale=(c.colors.length-1)/(c.hiColor-c.loColor)}}PL_Raster.prototype=Object.create(pl_proto.prototype);PL_Raster.prototype.constructor=PL_Raster;PL_Raster.prototype.init=function(){var b=new Array();var a=this.pins.colorOut;var f=this.scale;for(var d=0;d<this.rows;d++){for(var c=0;c<this.cols;c++){var e=this.source.CELLS(d,c);b.push({id:e.id,r:e.row,c:e.col,colorIdx:f*e[a]})}}return b};PL_Raster.prototype.glean=function(){var c=new Array();var b=this.pins.colorOut;var a=this.source;var d=a.changes[b];var e=this.scale;if(!d){return c}d.forEach(function(g){var f=a.CELLS(g);c.push({id:f.id,r:f.row,c:f.col,colorIdx:e*f[b]})});return c};PL_Raster.prototype.prereset=function(a){pl_proto.prototype.prereset.call(this,a);if(this.fstTime){this.fstTime=false;this.source=(typeof this.sourceName=="function")?this.sourceName.call(this.cap):this.cap[this.sourceName];if(this.interactive){var b=this;this.source[this.pins.colorIn]=function(){var e=0;var f=b.bucket[this.id];if(f){e=f.colorIdx}return e}}}if(this.interactive){var d=this.rast.getInitBucket();for(var c in d){if(d[c].colorIdx){this.bucket[c]=d[c]}else{(delete this.bucket[c])}}}};PL_Raster.prototype.reset=function(a,b){pl_proto.prototype.reset.call(this,a);var c=this.init();this.rast.reset(c)};PL_Raster.prototype.strobe=function(a,b){pl_proto.prototype.strobe.call(this,a,b);var c=this.glean();this.rast.render(c)};function PL_Tabulator(a,c,e){this.properties=c;this.size=c.size;this.start=c.start;var d=new Array();for(var b=0;b<this.size;b++){d.push("Out_"+((b<10)?"0"+b:b))}pl_proto.call(this,a,"Tabulator",[],d,[]);if(e!=null){if("source" in e){this.sourceName=e.source}if("In" in e){this.In=e.In}}this.buckets=new Array();for(var b=0;b<this.size;b++){this.buckets[b]=0;this[d[b]].exp=(function(){var f=b;return function(){return this.buckets[f]}.bind(this)}).call(this)}}PL_Tabulator.prototype=Object.create(pl_proto.prototype);PL_Tabulator.prototype.constructor=PL_Tabulator;PL_Tabulator.prototype.reset=function(f,l){pl_proto.prototype.reset.call(this,f,l);this.source=(typeof this.sourceName=="function")?this.sourceName.call(this.cap):this.cap[this.sourceName];this.kind=this.source.kind;var a=this.In;var e=this.buckets;var b=this.start;for(var k=0;k<e.length;k++){e[k]=0}switch(this.kind){case"CellMatrix":cm=this.source;this.State=new Object();for(var k=0;k<this.source.rows;k++){for(var h=0;h<this.source.cols;h++){var g=cm.CELLS(k,h);var c=g[a];this.State["C"+k+":"+h]=c;var d=c-b;if(d>=0&&d<e.length){e[d]++}}}break;default:break}};PL_Tabulator.prototype.strobe=function(c,f){pl_proto.prototype.strobe.call(this,c,f);var b=this.In;var e=this.source.changes[b];if(!e){return}var g=this.start;var d=this.buckets;var a=this.State;switch(this.kind){case"CellMatrix":cm=this.source;e.forEach(function(o){var k=cm.CELLS(o);var l=k[b];var h=l-g;var j=a[o];var i=(j==null)?null:j-g;if(h>=0&&h<d.length){d[h]++}if(i!=null&&i>=0&&i<d.length){d[i]--}a[o]=l});break;default:break}};