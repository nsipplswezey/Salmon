function raster(A,D,B,f,s,d,v){var I=(v)?v:D;var H=D;var b=I*f,c=H*B,K=B,k=f;var G=[],t=new Object();var F=h(s);var g=null;var L=d;var l=false;var M=0;var j=new Object();var z;var y;if(L){z=d3.select("body").append("div").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background-color","#FFFFAA").style("padding-left","3px").style("padding-right","3px")}function q(){d3.select(A).select(".g_main_cell").remove();if(!g){g=d3.select(A).append("svg").attr("width",b).attr("height",c).append("g").attr("id","g_main_parent").append("g").attr("class","g_main_cell").attr("transform","translate(0, 0)")}else{g=d3.select(A).select("#g_main_parent").append("g").attr("class","g_main_cell").attr("id","g_main_canvas").attr("transform","translate(0, 0)")}var u=g.append("svg:defs");u.append("svg:clipPath").attr("id","crect").append("svg:rect").attr("x",0).attr("y",0).attr("width",b).attr("height",c);var O=g.on("ondragstart",function(){return false}).on("ondrag",function(){l=true;cx=d3.mouse(this)[0];cy=d3.mouse(this)[1];rec=t[e(Math.floor(cy/H),Math.floor(cx/I))];if(rec){j[rec.id]=rec;M=rec.colorIdx;i([rec])}}).on("mousedown",function(){l=true;cx=d3.mouse(this)[0];cy=d3.mouse(this)[1];rec=t[e(Math.floor(cy/H),Math.floor(cx/I))];if(rec){M=rec.colorIdx}}).on("mouseup",function(){l=false}).on("mousemove",function(){if(l){cx=d3.mouse(this)[0];cy=d3.mouse(this)[1];rec=t[e(Math.floor(cy/H),Math.floor(cx/I))];a(rec,M);y=null;if(L){return z.style("visibility","hidden")}}else{if(L){cx=d3.mouse(this)[0];cy=d3.mouse(this)[1];var P=e(Math.floor(cy/H),Math.floor(cx/I));rec=t[P];y=P;return z.style("top",(event.pageY-10)+"px").style("left",(event.pageX+10)+"px").text(rec.colorIdx)}}}).on("click",function(){cx=d3.mouse(this)[0];cy=d3.mouse(this)[1];rec=t[e(Math.floor(cy/H),Math.floor(cx/I))];var R=Object.keys(F);var P=nsutil.binaryIndexOf(R,rec.colorIdx);var Q;if(+R[P]>rec.colorIdx){Q=+R[P]}else{Q=+R[(P+1)%R.length]}a(rec,Q);if(L){z.text(rec.colorIdx)}l=false});if(L){O=O.on("mouseover",function(){cx=d3.mouse(this)[0];cy=d3.mouse(this)[1];var P=e(Math.floor(cy/H),Math.floor(cx/I));rec=t[P];y=P;return z.style("visibility","visible").text(rec.colorIdx)}).on("mouseout",function(){y=null;return z.style("visibility","hidden")})}O.append("rect").attr("id","mouserect").attr("class","click-capture").attr("x",0).attr("y",0).attr("width",b).attr("height",c);g.append("g").attr("id","cellmatrix")}function a(O,u){if(O){j[O.id]=O;O.colorIdx=u;i([O])}}function r(){G=[];t=new Object();j=new Object()}function i(O){var u=g.select("#cellmatrix").selectAll("rect").data(O,function(P){return P.id});u.enter().append("rect").attr("clip-path","url(#crect)").attr("id",function(P){return P.id}).attr("x",0).attr("y",0).attr("width",I+1).attr("height",H+1).attr("transform",function(P){return"translate("+I*P.c+", "+H*P.r+")"}).attr("fill",w);u.attr("fill",w)}function w(u){t[u.id].colorIdx=u.colorIdx;if(y==u.id){z.text(u.colorIdx)}return p(u.colorIdx,F)}function h(Q){if(!Q){return Q}if(Array.isArray(Q)){return Q}var P=Object.keys(Q);var u=new Array();for(var O in P){u[+P[O]]=Q[P[O]]}return u}function m(P,Q,O){unit=P;K=Q;k=O;b=P*O;c=P*Q;q();i(G)}function n(){var u="#";for(var O=0;O<3;O++){u=u+Math.floor(16*Math.random()).toString(16)}return u}function C(Q){r();q();for(var O in Q){var P=Q[O];G.push(P);t[P.id]=P}for(var O=0;O<K;O++){for(var u=0;u<k;u++){var S=e(O,u);if(t[S]){continue}var R={id:S,r:O,c:u,colorIdx:0};G.push(R);t[S]=R}}i(G)}function x(u){i(u)}function J(){return j}function e(O,u){return"C"+O+":"+u}C();function E(O){var u=O.substring(1).split(":");return{row:+u[0],col:+u[1]};o}function N(O,P,u){document.getElementById("g_main_parent").addEventListener(O,P,u)}function p(T,O){if(T==undefined){return O[0]}if(T in O){return O[T]}var R=Object.keys(O);if(T<=+R[0]){return O[R[0]]}if(T>=+R[R.length-1]){return O[R[R.length-1]]}var Q=0;while(!(T>=+R[Q]&&T<+R[Q+1])){Q++}var S=(+R[Q+1])-(+R[Q]);var u=(T-(+R[Q]))/S;clow=d3.rgb(O[R[Q]]);chi=d3.rgb(O[R[Q+1]]);var P=d3.interpolate(clow,chi)(u);return P}return{render:x,reset:C,getInitBucket:J,idMaker:e,parseId:E,addEventListener:N}};