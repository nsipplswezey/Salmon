function fnetviewer(U,l,aa,u,p,K,H,Q,V,j,I,q,n){var ae=(V)?V:10,w=(j)?j:10;var G=p;var v=0;var a=l,g=aa;var X=u,O=10;var i=(H)?H:-800;var t=(Q)?Q:200;var o=d3.rgb("magenta");var M=I;var R=(q==null)?0.1:q;var P=(n==null)?0.1:n;var E=[],B=[],Z=new Object(),A=new Object;var Y=m(K);var f=d3.scale.linear().domain([0,G]).range([0,Y.length]);var T=d3.scale.linear().domain(d3.range(Y.length)).range(Y);var D=d3.scale.linear().domain([-1,G]).range([0,X]);var k,s,N,ab,h;function F(){d3.select(U).select("svg").remove();k=d3.select(U).append("svg").attr("width",a).attr("height",g).attr("class","g_main_agent").attr("transform","translate(0, 0)");h=d3.layout.force().charge(i).linkDistance(t).gravity(q).size([a,g]);var ag=k.append("svg:defs");ag.append("svg:clipPath").attr("id","crect").append("svg:rect").attr("x",0).attr("y",0).attr("width",a).attr("height",g);ag.selectAll("marker").data(["a_black","a_red","a_magenta"]).enter().append("marker").attr("id",function(ah){return ah}).attr("viewBox","0 -5 10 10").attr("refX",8).attr("refY",0).attr("markerWidth",3).attr("markerHeight",3).attr("orient","auto").attr("fill",function(ah){return ah.substring(2)}).append("path").attr("d","M0,-5L10,0L0,5");k.append("rect").attr("class","click-capture").attr("x",0).attr("y",0).attr("width",a).attr("height",g).style("fill","#ffffff")}function J(){E=[];Z=new Object();B=[];A=new Object()}function z(ah,ag){lscale=d3.scale.linear().domain([0,d3.max(ag,function(ak){return ak.strength})]).range([0,16]);v=Math.max(v,d3.max(ag,function(ak){return(ak.flow)?ak.flow:0}));var aj=k.selectAll(".link").data(h.links());aj.enter().append("path").attr("class","link").attr("d",function(ak){return"M"+ak.source.x+","+ak.source.y+"L"+ak.target.x+","+ak.target.y}).attr("stroke-width",function(ak){return Math.sqrt(lscale(ak.strength))}).attr("stroke","black").attr("stroke-opacity",0.6).attr("marker-end","url(#a_black)").on("mouseover",function(ak){ak.mousein=true;d3.select(this).attr("stroke","red").attr("marker-end","url(#a_red)").append("svg:title").text((ak.flow)?ak.flow:0)}).on("mouseout",function(ak){ak.mousein=false;d3.select(this).attr("stroke",e).attr("marker-end",function(){"url(#a_"+((ak.flow>0)?"magenta":"black")+")"}).attr("stroke","black").attr("marker-end","url(#a_black)").selectAll("title").remove()});aj.attr("stroke",function(ak){return(ak.mousein)?"red":e(ak)}).attr("marker-end",function(ak){return(ak.mousein)?"url(#a_red)":"url(#a_"+((ak.flow>0)?"magenta":"black")+")"});var ai=k.selectAll(".node").data(h.nodes());ai.enter().append("circle").attr("class","node").attr("r",function(ak){return ak.r}).style("fill",function(ak){return ak.color}).on("mouseover",function(ak){d3.select(this).append("svg:title").text(function(){return ak.wt})}).on("mouseout",function(ak){d3.select(this).selectAll("title").remove()}).call(h.drag);h.on("tick",c);ai.attr("r",function(ak){return ak.r}).style("fill",function(ak){return ak.color})}function c(aj){var ai=k.selectAll(".link");ai.attr("d",function(ak){diffX=ak.target.x-ak.source.x;diffY=ak.target.y-ak.source.y;pathLength=Math.sqrt((diffX*diffX)+(diffY*diffY));offsetX=(pathLength>0)?(diffX*(ak.target.r)*1.2)/pathLength:0;offsetY=(pathLength>0)?(diffY*(ak.target.r)*1.2)/pathLength:0;return"M"+ak.source.x+","+ak.source.y+"L"+(ak.target.x-offsetX)+","+(ak.target.y-offsetY)});if(M!=null){var ag=P*aj.alpha;h.nodes().forEach(function(al,ak){al.y+=(M[al.group].y-al.y)*ag;al.x+=(M[al.group].x-al.x)*ag})}var ah=k.selectAll(".node").data(h.nodes());ah.attr("cx",function(ak){return ak.x}).attr("cy",function(ak){return ak.y})}function e(ah){if(ah.flow){var ag=10*ah.flow/v;return d3.rgb(ag*o.r,ag*o.g,ag*o.b)}return"black"}function x(ag,ah){a=ag;g=ah;F();z(E,B)}function b(ah,ag){if(ah.length==0){return}for(var ai in ah){var aj=ad(ah[ai]);E.push(aj);Z[ah[ai].id]=aj}B=[];for(var ai in ag){B.push(d(ag[ai]));A[ac(ag[ai])]=B[ai]}h.nodes(E).links(B).start();z(E,B)}function L(ah,ag){for(var ai in ah){var aj=ah[ai];var ak=Z[aj.id];if(!ak){ak={};E.push(ak);Z[aj.id]=ak}ad(aj,ak)}for(var ai in ag){link0=ag[ai];link=A[ac(link0)];if(!link){continue}for(key in link0){if(key!="source"&&key!="target"){link[key]=link0[key]}}}z(E,B)}function ad(ag,ah){if(!ah){ah={}}ah.id=ag.id;ah.cy=Math.floor(ag.id/w);ah.cx=ag.id%w;ah.wt=ag.wt;ah.group=ag.group;ah.r=(ag.r)?ag.r:(ag.wt)?D(ag.wt):O;ah.color=(ag.color!=null)?ag.color:(ag.wt!=null)?T(f(ag.wt)):"black";return ah}function C(){var ag="#";for(var ah=0;ah<3;ah++){ag=ag+Math.floor(16*Math.random()).toString(16)}return ag}function r(ah,ag){b(ah,ag)}function y(ah){if(ah.length==0){return}for(var ag in ah){delete Z[ah[ag]]}E=new Array();for(var ai in Z){E.push(Z[ai])}}function W(ah,ag){J();F();b(ah,ag)}function ac(ag){return ag.source*10000+ag.target}function af(ag){return{cy:Math.floor(ag/w),cx:ag%w}}function S(ag){return ag.cy*w+ag.cx}function d(ai){if(ai===null||typeof ai!=="object"){return ai}var ag=ai.constructor();for(var ah in ai){ag[ah]=d(ai[ah])}return ag}function m(aj){if(!aj){return aj}if(Array.isArray(aj)){return aj}var ai=Object.keys(aj);var ag=new Array();for(var ah in ai){ag[+ai[ah]]=aj[ai[ah]]}return ag}W([],[]);return{render:L,reset:W,create:r,kill:y,idToCoords:af,coordsToId:S}};